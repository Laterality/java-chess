<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>체스 방</title>
</head>

<body>
    <div>
        방 번호 : {{id}}
        방 이름 : {{title}}
    </div>

    <div>
        <textarea name="" id="game-board" cols="20" rows="10" data-id="{{id}}" readonly></textarea>
        from : <input type="text" id="from" />
        to : <input type="text" id="to" />
        <button id="btn_move">이동</button>
    </div>

    <script>
        function stateToString(pieceType) {
            if (pieceType == "NONE") {
                return ".";
            }
            if (pieceType == "ROOK_WHITE") {
                return "r";
            }
            if (pieceType == "KNIGHT_WHITE") {
                return "n";
            }
            if (pieceType == "BISHOP_WHITE") {
                return "b";
            }
            if (pieceType == "QUEEN_WHITE") {
                return "q";
            }
            if (pieceType == "KING_WHITE") {
                return "k";
            }
            if (pieceType == "PAWN_WHITE") {
                return "p";
            }
            if (pieceType == "ROOK_BLACK") {
                return "R";
            }
            if (pieceType == "KNIGHT_BLACK") {
                return "N";
            }
            if (pieceType == "BISHOP_BLACK") {
                return "B";
            }
            if (pieceType == "QUEEN_BLACK") {
                return "Q";
            }
            if (pieceType == "KING_BLACK") {
                return "K";
            }
            if (pieceType == "PAWN_BLACK") {
                return "P";
            }
        }
        let id = document.getElementById("game-board").getAttribute("data-id");
        const xhr = new XMLHttpRequest();
        xhr.addEventListener("load", drawBoard);
        xhr.open("GET", "/board?id=" + id);
        xhr.send();

        document.getElementById("btn_move").addEventListener("click", function () {
            let from = document.getElementById("from").value;
            let to = document.getElementById("to").value;

            xhr.addEventListener("load", drawBoard);
            xhr.open("PUT", "/move-piece?id="+ id + "&from=" + from + "&to=" + to);
            xhr.send();

        });

        let xAxis = ["a", "b", "c", "d", "e", "f", "g", "h"];
        let yAxis = [8, 7, 6, 5, 4, 3, 2, 1];

        function drawBoard() {
                const states = JSON.parse(xhr.response);
                console.log(states);
                let str = "";
                yAxis.forEach(y => {
                    xAxis.forEach(x => {
                        str += stateToString(states[x + y]);
                    });
                    str += '\n';
                });
                document.getElementById("game-board").value = str;
            }

    </script>
</body>

</html>